<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Profile</title>
<link rel="stylesheet" href="../css/Profile.css">
</head>
<body>
<div class="container">
    <div class="top-buttons">
        <a href="/Home" class="btn">Back</a>
        <a href="/logout" class="btn">Logout</a>
    </div>

    <h1>Your Details</h1>
    <p class="detail">Name: <strong><%= name %></p></strong>
    <p class="detail">Roll No: <strong><%= RollNo %></p></strong>
    <p class="detail">Email: <strong><%= email %></p></strong>

    <% if (path) { %>
        <p class="detail">Selected Path: <strong><%= path.toUpperCase()%></strong></p>
    <% } %>

    <div class="path-form">
        <form action="/selectPath" method="post" id="pathForm">
            <label for="HorB">Choose Path:</label>
            <select name="path" id="HorB" onchange="confirmPathChange(this)">
                <option value="btp" <%= path === "btp" ? "selected" : "" %>>BTP</option>
                <option value="honours" <%= path === "honours" ? "selected" : "" %>>Honours</option>
            </select>
        </form>
    </div>

    <p class="cgpa">CGPA: <%= CGPA %></p>

    <h2>SGPA for each semester</h2>
    <ul>
      <% allSemesters.forEach(s => { %>
        <li class="semester-item">
          <span>Semester <%= s.semester %>: <%= (s.sgpa || 0).toFixed(2) %></span>
          <form action="/deleteSemester" method="POST" class="delete-form">
            <input type="hidden" name="semester" value="<%= s.semester %>">
            <button type="submit" class="btn delete-btn">Delete</button>
          </form>
        </li>
      <% }) %>
    </ul>
</div>

<script>
function confirmPathChange(select) {
    const currentPath = "<%= path %>";
    const newPath = select.value;

    if (currentPath && currentPath !== newPath) {
        const confirmed = confirm(
            "Warning: Changing your path will delete all data for Semesters 5 to 8. Do you want to continue?"
        );
        if (confirmed) {
            document.getElementById('pathForm').submit();
        } else {
            select.value = currentPath;
        }
    } else {
        document.getElementById('pathForm').submit();
    }
}
</script>
</body>
</html>
